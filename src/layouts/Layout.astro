---
import { Font } from "astro:assets";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import StartProjectCta from "../components/StartProjectCta.astro";
import SmoothScroll from "../components/SmoothScroll.astro";
import { useTranslations } from "../i18n/utils";
import "../styles/global.css";

const { title } = Astro.props;
const t = useTranslations();

const links = [
  { title: "Home", url: "/" },
  { title: "About", url: "/about" },
  { title: "Services", url: "/services" },
  { title: "Industries", url: "/industries" },
  { title: "Projects", url: "/projects" },
  { title: "Articles", url: "/articles" },
];
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <Font cssVariable="--font-roboto-slab" preload />
    <Font cssVariable="--font-inter" preload />
    <title>{title}</title>
  </head>
  <body>
    <a href="#main" class="skip-link">{t("accessibility.skip-to-content")}</a>
    <Header
      logoUrl="/"
      logoAlt="VIIO"
      links={links}
      link2={{ title: "Contact Us", url: "/contact" }}
    />
    <main id="main">
      <slot />
      {title !== "Contact" && <StartProjectCta />}
    </main>
    <div class="project-modal" data-project-modal aria-hidden="true">
      <div class="project-modal__backdrop" data-modal-close></div>
      <div class="project-modal__panel" role="dialog" aria-modal="true" aria-labelledby="project-modal-title" tabindex="-1">
        <button class="project-modal__close" type="button" data-modal-close aria-label="Close">
          <span aria-hidden>Ã—</span>
        </button>
        <div class="project-modal__header">
          <h2 id="project-modal-title" class="u-heading">Project requirement</h2>
          <p class="u-text">Share your goals and we will reply within 24 hours.</p>
        </div>
        <form class="project-modal__form">
          <div class="project-modal__grid">
            <label class="project-modal__field">
              <span class="u-text">Full name</span>
              <input type="text" name="name" placeholder="Your name" required />
            </label>
            <label class="project-modal__field">
              <span class="u-text">Work email</span>
              <input type="email" name="email" placeholder="you@company.com" required />
            </label>
            <label class="project-modal__field">
              <span class="u-text">Company</span>
              <input type="text" name="company" placeholder="Company name" />
            </label>
            <label class="project-modal__field">
              <span class="u-text">Budget range</span>
              <select name="budget" required>
                <option value="" disabled selected>Select a range</option>
                <option value="under-10k">Under $10k</option>
                <option value="10k-25k">$10k - $25k</option>
                <option value="25k-50k">$25k - $50k</option>
                <option value="50k-100k">$50k - $100k</option>
                <option value="100k-plus">$100k+</option>
              </select>
            </label>
            <label class="project-modal__field project-modal__field--full">
              <span class="u-text">Project details</span>
              <textarea name="details" rows="4" placeholder="Tell us about your project goals, timeline, and scope." required></textarea>
            </label>
          </div>
          <button class="project-modal__submit" type="submit">Send requirements</button>
        </form>
      </div>
    </div>
    <Footer logoUrl="/" logoAlt="VIIO" links={links} />
    <SmoothScroll />
  </body>
</html>

<style>
  .skip-link {
    background: var(--color-brand-1);
    left: 0;
    right: 0;
    margin: auto;
    width: min-content;
    white-space: nowrap;
    padding: 0.5rem;
    position: absolute;
    transform: translateY(-100%);
    transition: transform 0.3s ease;
    z-index: 100;
  }

  .skip-link:focus {
    transform: translateY(0%);
  }
</style>

<script>
  import "../utils/reveals";

  const modal = document.querySelector<HTMLElement>("[data-project-modal]");
  const modalPanel = document.querySelector<HTMLElement>(".project-modal__panel");

  const openModal = () => {
    if (!modal) return;
    modal.setAttribute("aria-hidden", "false");
    document.body.classList.add("is-modal-open");
    modalPanel?.focus();
  };

  const closeModal = () => {
    if (!modal) return;
    modal.setAttribute("aria-hidden", "true");
    document.body.classList.remove("is-modal-open");
  };

  document.addEventListener("click", (event) => {
    const target = event.target as HTMLElement | null;
    if (!target) return;

    const trigger = target.closest<HTMLElement>("[data-modal='project']");
    if (trigger) {
      event.preventDefault();
      openModal();
      return;
    }

    if (target.closest("[data-modal-close]")) {
      event.preventDefault();
      closeModal();
    }
  });

  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
      closeModal();
    }
  });
</script>
