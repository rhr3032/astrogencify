---
import Logo from "../assets/logo.svg";
import { FaLinkedinIn, FaDribbble, FaBehance, FaInstagram, FaFacebookF, FaPinterestP } from "react-icons/fa";
import type { Link } from "../types";

interface Props {
  logoUrl: string;
  logoAlt: string;
  links: Link[];
}

const { logoUrl, logoAlt, links } = Astro.props;

const importantLinks = [
  { title: "Contact Us", url: "/contact" },
  { title: "About Us", url: "/about" },
  { title: "Services", url: "/services" },
  { title: "Projects", url: "/projects" },
  { title: "Industry", url: "/industries" },
  { title: "Articles", url: "/articles" },
];

const servicesLinks = [
  { title: "Branding & Identity", url: "/services/branding" },
  { title: "UI/UX Design", url: "/services/ui-ux" },
  { title: "Webflow Design", url: "/services/webflow-design" },
  { title: "Framer Design", url: "/services/framer-design" },
  { title: "Web Development", url: "/services/web-development" },
  { title: "Mobile Development", url: "/services/mobile-development" },
  { title: "SaaS Product Delivery", url: "/services/saas-products" },
  { title: "ERP & LMS Systems", url: "/services/erp-lms" },
  { title: "QA & Testing", url: "/services/qa-testing" },
  { title: "Business Consulting", url: "/services/business-consulting" },
  { title: "DevOps & Cloud", url: "/services/devops-cloud" },
  { title: "API Development", url: "/services/api-development" },
];

const industryLinks = [
  { title: "Fintech Industry", url: "/industries/fintech" },
  { title: "Healthcare & Fitness Industry", url: "/industries/healthcare" },
  { title: "E-commerce Industry", url: "/industries/ecommerce" },
  { title: "Edtech Industry", url: "/industries/edtech" },
  { title: "Cybersecurity Industry", url: "/industries/cybersecurity" },
  { title: "Real Estate Industry", url: "/industries/real-estate" },
  { title: "Travel & Hospitality Industry", url: "/industries/travel" },
  { title: "Fitness & Wellness Industry", url: "/industries/fitness" },
  { title: "Legal Industry", url: "/industries/legal" },
  { title: "Manufacturing Industry", url: "/industries/manufacturing" },
  { title: "Marketing & Advertising Industry", url: "/industries/marketing" },
  { title: "Food & Restaurant Industry", url: "/industries/food-restaurant" },
];


const partners = [
  { name: "Framer", badge: "Professional Partner", logo: "framer" },
  { name: "Webflow", badge: "Professional Partner", logo: "webflow" },
  { name: "Behance", badge: "Top Team On Behance", logo: "behance" },
  { name: "Dribbble", badge: "Top Team On Dribbble", logo: "dribbble" },
  { name: "Clutch", badge: "Reviewed On", rating: true, logo: "clutch" },
  { name: "Google", badge: "Reviewed On", rating: true, logo: "google" },
];

const socialLinks = [
  { title: "Facebook", url: "https://facebook.com", icon: FaFacebookF },
  { title: "Instagram", url: "https://www.instagram.com", icon: FaInstagram },
  { title: "LinkedIn", url: "https://www.linkedin.com", icon: FaLinkedinIn },
  { title: "Behance", url: "https://www.behance.net", icon: FaBehance },
  { title: "Dribbble", url: "https://dribbble.com", icon: FaDribbble },
  { title: "Pinterest", url: "https://pinterest.com", icon: FaPinterestP },
];
---

<sy-footer>
  <footer>
    <div class="inner u-container">
      <div class="wrapper">
        <div class="top">
          <div class="links-col">
            <div class="brand-mini">
              <div class="brand-mini__logo">
                <Logo />
              </div>
              <p class="u-text brand-mini__text">Build with clarity. Ship with confidence.</p>
            </div>
          </div>

          <div class="links-col">
            <h3 class="u-text label">Important Links</h3>
            <ul>
              {
                importantLinks.map((l) => (
                  <li>
                    <a href={l.url}>{l.title}</a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div class="links-col">
            <h3 class="u-text label">Services</h3>
            <ul>
              {
                servicesLinks.map((l) => (
                  <li>
                    <a href={l.url}>{l.title}</a>
                  </li>
                ))
              }
            </ul>
          </div>

          <div class="links-col">
            <h3 class="u-text label">Specialized Industry</h3>
            <ul>
              {
                industryLinks.map((l) => (
                  <li>
                    <a href={l.url}>{l.title}</a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>

        <div class="partners">
          {
            partners.map((p) => (
              <div class="partner-item">
                <div class="partner-logo" data-logo={p.logo}>
                  {p.name}
                </div>
                <div class="partner-badge">
                  {p.badge}
                  {p.rating && <span class="stars">★★★★★</span>}
                </div>
              </div>
            ))
          }
        </div>

        <div class="bottom">
          <a href="/terms" class="legal-link">Terms & Conditions</a>
          <p class="cp">© {new Date().getFullYear()}, {logoAlt}, All Rights Reserved.</p>
          <a href="/privacy" class="legal-link">Privacy Policy</a>
        </div>

        <div class="brand-mark">
          <div class="brand-text" aria-hidden="true">viio</div>
          <div class="social-icons">
            {
              socialLinks.map((s) => (
                <a 
                  href={s.url} 
                  target="_blank" 
                  rel="noreferrer"
                  class="social-icon"
                  aria-label={s.title}
                >
                  {s.icon && <s.icon size={20} />}
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </footer>
</sy-footer>

<style>
  sy-footer {
    @extend %u-text;

    --fs: var(--font-size-sm);
    display: block;
    clip-path: inset(0);

    :global(&.has-no-anim footer) {
      position: static;
      opacity: 1;
      clip-path: none;
    }
  }

  footer {
    background: #0a0b0d;
    color: rgba(255, 255, 255, 0.7);
    position: fixed;
    bottom: 0;
    width: 100%;
    overflow: hidden;
    opacity: 0;
    will-change: clip-path, opacity;
  }

  .inner {
    padding: 4rem 0 2rem;
  }

  .wrapper {
    display: flex;
    flex-direction: column;
    gap: 3.5rem;
    position: relative;
  }

  .top {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 3rem;

    @media (--mq-tablet) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 2.5rem;
    }

    @media (--mq-phone) {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }

  .links-col {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .brand-mini {
    display: grid;
    gap: 0.65rem;
  }

  .brand-mini__logo {
    width: 3.25rem;
    height: 1rem;
  }

  .brand-mini__logo :global(svg) {
    width: 100%;
    height: 100%;
  }

  .brand-mini__logo :global(path) {
    fill: rgba(255, 255, 255, 0.85);
  }

  .brand-mini__text {
    --fs: var(--font-size-xs);
    color: rgba(255, 255, 255, 0.6);
    max-width: 14rem;
  }

  .label {
    --fs: var(--font-size-base);
    --fw: 500;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
  }

  .links-col ul {
    display: grid;
    gap: 0.65rem;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .links-col a {
    text-decoration: none;
    color: rgba(255, 255, 255, 0.55);
    position: relative;
    display: inline-block;
    --fs: var(--font-size-sm);
    transition: color 0.3s ease;
  }

  .links-col a:hover,
  .links-col a:focus {
    color: rgba(255, 255, 255, 0.9);
  }

  .partners {
    display: grid;
    grid-template-columns: repeat(6, minmax(0, 1fr));
    gap: 2rem;
    padding: 2rem 0;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);

    @media (--mq-desktop-sm) {
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    @media (--mq-tablet) {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    @media (--mq-phone) {
      grid-template-columns: 1fr;
    }
  }

  .partner-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-start;
  }

  .partner-logo {
    --fs: var(--font-size-lg);
    --fw: 700;
    color: rgba(255, 255, 255, 0.9);
    font-family: var(--font-family-display);
  }

  .partner-logo[data-logo="framer"] {
    color: #0af;
  }

  .partner-logo[data-logo="webflow"] {
    color: #4353ff;
  }

  .partner-logo[data-logo="behance"] {
    color: #1769ff;
  }

  .partner-logo[data-logo="dribbble"] {
    color: #ea4c89;
  }

  .partner-logo[data-logo="clutch"] {
    color: #fff;
  }

  .partner-logo[data-logo="google"] {
    background: linear-gradient(90deg, #4285f4, #ea4335, #fbbc05, #34a853);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .partner-badge {
    --fs: var(--font-size-xs);
    color: rgba(255, 255, 255, 0.5);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .stars {
    color: #fbbf24;
    letter-spacing: -0.05em;
  }

  .bottom {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1.5rem;
    position: relative;
    z-index: 2;

    @media (--mq-phone) {
      flex-direction: column;
      text-align: center;
    }
  }

  .legal-link {
    --fs: var(--font-size-sm);
    color: rgba(255, 255, 255, 0.6);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .legal-link:hover,
  .legal-link:focus {
    color: rgba(255, 255, 255, 0.9);
  }

  .cp {
    --fs: var(--font-size-sm);
    color: rgba(255, 255, 255, 0.5);
    margin: 0;
  }

  .brand-mark {
    position: relative;
    display: flex;
    align-items: flex-end;
    justify-content: space-between;
    margin-top: -1rem;
    padding-bottom: 1rem;

    @media (--mq-phone) {
      flex-direction: column;
      align-items: center;
      gap: 2rem;
    }
  }

  .brand-text {
    font-size: clamp(4rem, 15vw, 12rem);
    font-weight: 800;
    line-height: 0.9;
    color: rgba(255, 255, 255, 0.03);
    font-family: var(--font-family-display);
    letter-spacing: -0.02em;
    user-select: none;
    pointer-events: none;

    @media (--mq-phone) {
      font-size: clamp(3rem, 20vw, 6rem);
    }
  }

  .social-icons {
    display: flex;
    gap: 0.75rem;
    position: relative;
    z-index: 2;
    padding-bottom: 0.5rem;
  }

  .social-icon {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.12);
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .social-icon:hover,
  .social-icon:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
  }

  .icon-text {
    --fs: var(--font-size-xs);
    --fw: 600;
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
  }
</style>

<script>
  import { addResizeObserver } from "../utils/observers";
  import gsap from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";

  class Footer extends HTMLElement {
    private shutterTween: gsap.core.Tween | null = null;
    private scrollTrigger: ScrollTrigger | null = null;

    connectedCallback() {
      addResizeObserver(this);

      this.onResize();
      this.initShutterAnimation();
    }

    initShutterAnimation() {
      const footer = this.firstElementChild as HTMLElement;
      
      // Set initial state - footer is clipped from bottom
      gsap.set(footer, {
        clipPath: "inset(100% 0% 0% 0%)",
      });

      // Create shutter open animation tied to scroll
      this.shutterTween = gsap.to(footer, {
        clipPath: "inset(0% 0% 0% 0%)",
        ease: "none",
      });

      // Trigger animation when footer comes into view
      this.scrollTrigger = ScrollTrigger.create({
        trigger: this,
        start: "top bottom",
        end: "top 60%",
        scrub: 1,
        animation: this.shutterTween,
        onEnter: () => {
          footer.style.opacity = "1";
        },
        onLeaveBack: () => {
          footer.style.opacity = "0";
        }
      });
    }

    onResize() {
      const inner = this.firstElementChild as HTMLElement;
      const bcr = inner.getBoundingClientRect();

      if (bcr.height + 100 > window.innerHeight) {
        this.style.height = "";
        this.classList.add("has-no-anim");
        
        // Disable shutter animation for tall footers
        if (this.scrollTrigger) {
          this.scrollTrigger.kill();
          this.scrollTrigger = null;
        }
        if (this.shutterTween) {
          this.shutterTween.kill();
          this.shutterTween = null;
        }
        
        const footer = inner;
        gsap.set(footer, { clearProps: "clipPath,opacity" });
      } else {
        this.style.height = `${bcr.height}px`;
        this.classList.remove("has-no-anim");
        
        // Re-init shutter animation if it was disabled
        if (!this.scrollTrigger && !this.shutterTween) {
          this.initShutterAnimation();
        }
      }
    }
  }

  customElements.define("sy-footer", Footer);
</script>
